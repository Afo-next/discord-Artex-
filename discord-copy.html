<!-- Discord - это платформа для общения, которая изначально была создана для геймеров, но со временем стала популярной среди различных сообществ. Она предоставляет пользователям возможность создавать серверы, которые могут содержать текстовые и голосовые каналы.

### Основные    функции Discord:

1. **Серверы и каналы**:
   - Пользователи могут создавать свои собственные серверы или присоединяться к существующим.
   - Серверы могут содержать текстовые и голосовые каналы.
   - Текстовые каналы предназначены для обмена сообщениями, ссылками, изображениями и файлами.
   - Голосовые каналы позволяют пользователям общаться в реальном времени с помощью микрофона.

2. **Роли и разрешения**:
   - Администраторы серверов могут создавать роли и назначать их пользователям.
   - Роли могут иметь различные уровни разрешений, такие как управление каналами, модерация сообщений и т.д.

3. **Чат и сообщения**:
   - Пользователи могут отправлять текстовые сообщения, изображения, видео и файлы.
   - Поддержка эмодзи и реакций на сообщения.
   - Возможность упоминания других пользователей с помощью @.

4. **Голосовые и видеозвонки**:
   - Поддержка голосовых и видеозвонков как в группах, так и в личных сообщениях.
   - Возможность демонстрации экрана.

5. **Боты**:
   - Пользователи могут добавлять ботов на свои серверы для автоматизации различных задач, таких как модерация, игры, музыка и т.д.

6. **Интеграции**:
   - Поддержка интеграций с различными сервисами, такими как Twitch, YouTube, Spotify и другими.

### Платные функции (Discord Nitro):

1. **Улучшенные эмодзи**:
   - Пользователи могут использовать анимированные эмодзи и загружать свои собственные.

2. **Улучшенное качество видео**:
   - Возможность стриминга видео в более высоком разрешении и с более высокой частотой кадров.

3. **Бустинг серверов**:
   - Пользователи могут "бустить" серверы, предоставляя им дополнительные функции, такие как улучшенное качество звука, большее количество эмодзи и т.д.

4. **Персонализация**:
   - Возможность изменять тег пользователя и использовать анимированные аватары.

### Дизайн и интерфейс:

1. **Темная и светлая темы**:
   - Пользователи могут переключаться между темной и светлой темами интерфейса.

2. **Навигация**:
   - Легкая навигация между серверами и каналами с помощью боковой панели.
   - Возможность закрепления часто используемых каналов и серверов.

3. **Настройки пользователя**:
   - Пользователи могут настраивать свои профили, изменять аватары, настраивать уведомления и многое другое.

### Мелкие непримечательные вещи:

1. **Уведомления**:
   - Настраиваемые уведомления для различных событий, таких как упоминания, личные сообщения и т.д.

2. **История сообщений**:
   - Возможность просмотра истории сообщений в текстовых каналах.

3. **Поиск**:
   - Функция поиска позволяет находить сообщения, пользователей и каналы.

Discord предоставляет мощный и гибкий инструмент для общения и создания сообществ, который постоянно развивается и добавляет новые функции для улучшения пользовательского опыта.
 -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artex</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #36393f;
            color: #fff;
        }
        nav ul {
            display: flex;
            list-style: none;
            padding: 0;
            background: #2f3136;
            margin: 0;
        }
        nav ul li {
            margin-right: 20px;
            position: relative;
        }
        nav ul li a {
            color: #b9bbbe;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            transition: color 0.3s ease;
        }
        nav ul li a:hover {
            color: #fff;
        }
        section {
            margin: 20px 0;
        }
        #app {
            padding: 20px;
        }
        #popup, #login-popup, #success-popup, #server-users-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2f3136;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        #popup input, #login-popup input, #success-popup input, #server-users-popup input {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            background: #202225;
            border: 1px solid #202225;
            color: #b9bbbe;
        }
        #popup button, #login-popup button, #success-popup button, #server-users-popup button {
            padding: 10px;
            background: #7289da;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .message {
            position: relative;
        }
        .message-options {
            display: none;
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        .message:hover .message-options {
            display: block;
        }
        .timer {
            font-size: 12px;
            color: #ccc;
        }
        .settings-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #7289da;
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        .settings-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2f3136;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .settings-panel input {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            background: #202225;
            border: 1px solid #202225;
            color: #b9bbbe;
        }
        .settings-panel button {
            padding: 10px;
            background: #7289da;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .emoji-picker {
            display: none;
            position: absolute;
            bottom: 50px;
            right: 10px;
            background: #2f3136;
            padding: 10px;
            border-radius: 10px;
            width: 200px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .emoji-picker .tab {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .emoji-picker .tab button {
            background: none;
            border: none;
            color: #b9bbbe;
            cursor: pointer;
        }
        .emoji-picker .tab button.active {
            color: #7289da;
        }
        .emoji-picker .content {
            display: flex;
            flex-wrap: wrap;
        }
        .emoji-picker .content span {
            font-size: 24px;
            margin: 5px;
            cursor: pointer;
        }
        .achievements {
            display: flex;
            gap: 10px;
        }
        .achievement {
            width: 50px;
            height: 50px;
            background: #7289da;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .achievement:hover::after {
            content: attr(data-title);
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            padding: 5px;
            border-radius: 5px;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
        }
        .file-upload {
            display: none;
            position: absolute;
            bottom: 50px;
            right: 50px;
            background: #2f3136;
            padding: 10px;
            border-radius: 10px;
            width: 200px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .file-upload input {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            background: #202225;
            border: 1px solid #202225;
            color: #b9bbbe;
        }
        .file-preview {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .file-preview img, .file-preview video {
            max-width: 100%;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Навигация -->
        <nav>
            <ul>
                <li><a href="#servers">Серверы</a></li>
                <li><a href="#channels">Каналы</a></li>
                <li><a href="#chat">Чат</a></li>
                <li><a href="#calls">Звонки</a></li>
                <li><a href="#bots">Боты</a></li>
                <li><a href="#integrations">Интеграции</a></li>
                <li><a href="#settings">Настройки</a></li>
            </ul>
        </nav>

        <!-- Серверы и каналы -->
        <section id="servers">
            <h2>Серверы и каналы</h2>
            <button id="create-server">Создать сервер</button>
            <div id="server-list">
                <!-- Список серверов -->
            </div>
            <div id="channel-list">
                <!-- Список каналов -->
            </div>
        </section>

        <!-- Чат -->
        <section id="chat">
            <h2>Чат</h2>
            <div id="message-list">
                <!-- Список сообщений -->
            </div>
            <input type="text" id="message-input" placeholder="Введите сообщение...">
            <button id="send-message">Отправить</button>
            <button id="emoji-button">😊</button>
            <button id="file-button">+</button>
            <div class="emoji-picker" id="emoji-picker">
                <div class="tab">
                    <button id="emoji-tab" class="active">Эмодзи</button>
                    <button id="sticker-tab">Стикеры</button>
                </div>
                <div class="content" id="emoji-content">
                    <!-- Эмодзи -->
                    <span>😀</span>
                    <span>😁</span>
                    <span>😂</span>
                    <span>🤣</span>
                    <span>😃</span>
                    <span>😄</span>
                    <span>😅</span>
                    <span>😆</span>
                    <span>😉</span>
                    <span>😊</span>
                    <span>😋</span>
                    <span>😎</span>
                    <span>😍</span>
                    <span>😘</span>
                    <span>😗</span>
                    <span>😙</span>
                    <span>😚</span>
                    <span>🙂</span>
                    <span>🤗</span>
                    <span>🤩</span>
                </div>
                <div class="content" id="sticker-content" style="display: none;">
                    <!-- Стикеры -->
                    <span>🦄</span>
                    <span>🐱</span>
                    <span>🐶</span>
                    <span>🐼</span>
                    <span>🐨</span>
                    <span>🐯</span>
                    <span>🦊</span>
                    <span>🐻</span>
                    <span>🐷</span>
                    <span>🐸</span>
                    <span>🐵</span>
                    <span>🐔</span>
                    <span>🐧</span>
                    <span>🐦</span>
                    <span>🐤</span>
                    <span>🐣</span>
                    <span>🐥</span>
                    <span>🦆</span>
                    <span>🦅</span>
                    <span>🦉</span>
                </div>
            </div>
            <div class="file-upload" id="file-upload">
                <input type="file" id="file-input" accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
                <div class="file-preview" id="file-preview">
                    <!-- Предпросмотр файлов -->
                </div>
                <button id="send-file">Отправить файл</button>
            </div>
        </section>

        <!-- Звонки -->
        <section id="calls">
            <h2>Голосовые и видеозвонки</h2>
            <button id="start-voice-call">Начать голосовой звонок</button>
            <button id="start-video-call">Начать видеозвонок</button>
            <button id="share-screen">Демонстрация экрана</button>
            <button id="end-call">Завершить звонок</button>
        </section>

        <!-- Боты -->
        <section id="bots">
            <h2>Боты</h2>
            <button id="add-bot">Добавить бота</button>
        </section>

        <!-- Интеграции -->
        <section id="integrations">
            <h2>Интеграции</h2>
            <button id="integrate-twitch">Интеграция с Twitch</button>
            <button id="integrate-youtube">Интеграция с YouTube</button>
            <button id="integrate-spotify">Интеграция с Spotify</button>
        </section>

        <!-- Настройки -->
        <section id="settings">
            <h2>Настройки пользователя</h2>
            <button id="change-avatar">Изменить аватар</button>
            <button id="change-username">Изменить имя пользователя</button>
            <button id="change-notifications">Настроить уведомления</button>
            <button id="change-language">Изменить язык</button>
            <div class="achievements">
                <div class="achievement" data-title="Достижение 1">1</div>
                <div class="achievement" data-title="Достижение 2">2</div>
                <div class="achievement" data-title="Достижение 3">3</div>
                <div class="achievement" data-title="Достижение 4">4</div>
                <div class="achievement" data-title="Достижение 5">5</div>
            </div>
        </section>

        <!-- Админ настройки -->
        <section id="admin-settings">
            <h2>Админ настройки</h2>
            <button id="add-admin-rights">Добавить права пользователю</button>
        </section>
    </div>

    <!-- Popup окно для регистрации -->
    <div id="popup">
        <h2>Регистрация</h2>
        <input type="email" id="email" placeholder="Введите email">
        <input type="password" id="password" placeholder="Введите пароль">
        <label>
            <input type="checkbox" id="remember-me">
            Запомнить меня на этом устройстве
        </label>
        <button id="register">Зарегистрироваться</button>
        <p>Уже есть аккаунт? <a href="#" id="show-login">Войти</a></p>
    </div>

    <!-- Popup окно для входа -->
    <div id="login-popup">
        <h2>Войти</h2>
        <input type="email" id="login-email" placeholder="Введите email">
        <input type="password" id="login-password" placeholder="Введите пароль">
        <label>
            <input type="checkbox" id="login-remember-me">
            Запомнить меня на этом устройстве
        </label>
        <button id="login">Войти</button>
        <p>Нет аккаунта? <a href="#" id="show-register">Регистрация</a></p>
    </div>

    <!-- Popup окно успешной регистрации -->
    <div id="success-popup">
        <h2>Успешная регистрация</h2>
        <p>Вы успешно зарегистрировались!</p>
        <button id="close-success-popup">Закрыть</button>
    </div>

    <!-- Popup окно пользователей сервера -->
    <div id="server-users-popup">
        <h2>Пользователи сервера</h2>
        <div id="user-list">
            <!-- Список пользователей -->
        </div>
        <button id="close-server-users-popup">Закрыть</button>
    </div>

    <!-- Панель настроек -->
    <div class="settings-panel" id="settings-panel">
        <h2>Настройки сайта</h2>
        <label for="profile-color">Цвет профиля:</label>
        <input type="color" id="profile-color">
        <label for="site-color">Цвет сайта:</label>
        <select id="site-color">
            <option value="#1f1c2c">Темный</option>
            <option value="#ffffff">Светлый</option>
            <option value="#ff00ff">Киберпанк</option>
            <option value="#00ffff">Футуристичный</option>
        </select>
        <button id="save-settings">Сохранить</button>
    </div>

    <button class="settings-button" id="open-settings">Настройки</button>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Показать popup окно при загрузке страницы
            document.getElementById('popup').style.display = 'block';

            // Обработчик регистрации
            document.getElementById('register').addEventListener('click', function() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const rememberMe = document.getElementById('remember-me').checked;

                // Сохранение данных пользователя в базе данных
                fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password, rememberMe })
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          document.getElementById('popup').style.display = 'none';
                          document.getElementById('success-popup').style.display = 'block';
                          if (rememberMe) {
                              localStorage.setItem('userEmail', email);
                              localStorage.setItem('userPassword', password);
                          }
                      } else {
                          alert('Ошибка регистрации: ' + data.message);
                      }
                  });
            });

            // Закрыть окно успешной регистрации
            document.getElementById('close-success-popup').addEventListener('click', function() {
                document.getElementById('success-popup').style.display = 'none';
            });

            // Обработчик входа
            document.getElementById('login').addEventListener('click', function() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const rememberMe = document.getElementById('login-remember-me').checked;

                // Проверка данных пользователя в базе данных
                fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password, rememberMe })
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Вход успешен!');
                          document.getElementById('login-popup').style.display = 'none';
                          if (rememberMe) {
                              localStorage.setItem('userEmail', email);
                              localStorage.setItem('userPassword', password);
                          }
                          loadUserData(data.userId);
                      } else {
                          alert('Ошибка входа: ' + data.message);
                      }
                  });
            });

            // Показать окно входа
            document.getElementById('show-login').addEventListener('click', function() {
                document.getElementById('popup').style.display = 'none';
                document.getElementById('login-popup').style.display = 'block';
            });

            // Показать окно регистрации
            document.getElementById('show-register').addEventListener('click', function() {
                document.getElementById('login-popup').style.display = 'none';
                document.getElementById('popup').style.display = 'block';
            });

            // Специальные возможности для rivusmaksima@gmail.com
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail === 'rivusmaksima@gmail.com') {
                const adminChat = document.createElement('section');
                adminChat.id = 'admin-chat';
                adminChat.innerHTML = `
                    <h2>Чат с администрацией</h2>
                    <div id="admin-message-list">
                        <!-- Список сообщений -->
                    </div>
                    <input type="text" id="admin-message-input" placeholder="Введите сообщение...">
                    <button id="send-admin-message">Отправить</button>
                `;
                document.getElementById('app').appendChild(adminChat);

                document.getElementById('send-admin-message').addEventListener('click', function() {
                    const message = document.getElementById('admin-message-input').value;
                    // Отправка сообщения в чат с администрацией
                    fetch('/admin-chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ message })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              const messageList = document.getElementById('admin-message-list');
                              const newMessage = document.createElement('div');
                              newMessage.textContent = message;
                              messageList.appendChild(newMessage);
                              document.getElementById('admin-message-input').value = '';
                          } else {
                              alert('Ошибка отправки сообщения: ' + data.message);
                          }
                      });
                });
            }

            // Создание сервера
            document.getElementById('create-server').addEventListener('click', function() {
                const serverName = prompt('Введите название сервера:');
                if (serverName) {
                    // Сохранение сервера в базе данных
                    fetch('/create-server', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ serverName })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Сервер создан успешно!');
                              // Обновление списка серверов
                              const serverList = document.getElementById('server-list');
                              const newServer = document.createElement('div');
                              newServer.textContent = serverName;
                              newServer.classList.add('server-item');
                              newServer.dataset.serverId = data.serverId;
                              serverList.appendChild(newServer);
                          } else {
                              alert('Ошибка создания сервера: ' + data.message);
                          }
                      });
                }
            });

            // Показать пользователей сервера
            document.getElementById('server-list').addEventListener('click', function(event) {
                if (event.target.classList.contains('server-item')) {
                    const serverId = event.target.dataset.serverId;
                    fetch(`/server-users/${serverId}`)
                        .then(response => response.json())
                        .then(data => {
                            const userList = document.getElementById('user-list');
                            userList.innerHTML = '';
                            data.users.forEach(user => {
                                const userItem = document.createElement('div');
                                userItem.textContent = `${user.name} (Последний вход: ${user.lastLogin})`;
                                userList.appendChild(userItem);
                            });
                            document.getElementById('server-users-popup').style.display = 'block';
                        });
                }
            });

            // Закрыть окно пользователей сервера
            document.getElementById('close-server-users-popup').addEventListener('click', function() {
                document.getElementById('server-users-popup').style.display = 'none';
            });

            // Начать голосовой звонок
            document.getElementById('start-voice-call').addEventListener('click', function() {
                // Логика для начала голосового звонка
                const peerConnection = new RTCPeerConnection();
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));
                        startCallTimer();
                    });
            });

            // Начать видеозвонок
            document.getElementById('start-video-call').addEventListener('click', function() {
                // Логика для начала видеозвонка
                const peerConnection = new RTCPeerConnection();
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(stream => {
                        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));
                        startCallTimer();
                    });
            });

            // Демонстрация экрана
            document.getElementById('share-screen').addEventListener('click', function() {
                // Логика для демонстрации экрана
                navigator.mediaDevices.getDisplayMedia({ video: true })
                    .then(stream => {
                        const peerConnection = new RTCPeerConnection();
                        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));
                        startCallTimer();
                    });
            });

            // Завершить звонок
            document.getElementById('end-call').addEventListener('click', function() {
                // Логика для завершения звонка
                const peerConnection = new RTCPeerConnection();
                peerConnection.close();
                stopCallTimer();
            });

            // Добавить бота
            document.getElementById('add-bot').addEventListener('click', function() {
                const botName = prompt('Введите имя бота:');
                if (botName) {
                    // Сохранение бота в базе данных
                    fetch('/add-bot', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ botName })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Бот добавлен успешно!');
                          } else {
                              alert('Ошибка добавления бота: ' + data.message);
                          }
                      });
                }
            });

            // Интеграция с Twitch
            document.getElementById('integrate-twitch').addEventListener('click', function() {
                // Логика для интеграции с Twitch
                fetch('/integrate-twitch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Интеграция с Twitch выполнена');
                      } else {
                          alert('Ошибка интеграции с Twitch: ' + data.message);
                      }
                  });
            });

            // Интеграция с YouTube
            document.getElementById('integrate-youtube').addEventListener('click', function() {
                // Логика для интеграции с YouTube
                fetch('/integrate-youtube', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Интеграция с YouTube выполнена');
                      } else {
                          alert('Ошибка интеграции с YouTube: ' + data.message);
                      }
                  });
            });

            // Интеграция с Spotify
            document.getElementById('integrate-spotify').addEventListener('click', function() {
                // Логика для интеграции с Spotify
                fetch('/integrate-spotify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Интеграция с Spotify выполнена');
                      } else {
                          alert('Ошибка интеграции с Spotify: ' + data.message);
                      }
                  });
            });

            // Изменить аватар
            document.getElementById('change-avatar').addEventListener('click', function() {
                const avatarUrl = prompt('Введите URL аватара:');
                if (avatarUrl) {
                    // Сохранение аватара в базе данных
                    fetch('/change-avatar', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ avatarUrl })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Аватар изменен успешно!');
                          } else {
                              alert('Ошибка изменения аватара: ' + data.message);
                          }
                      });
                }
            });

            // Изменить имя пользователя
            document.getElementById('change-username').addEventListener('click', function() {
                const username = prompt('Введите новое имя пользователя:');
                if (username) {
                    // Сохранение имени пользователя в базе данных
                    fetch('/change-username', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Имя пользователя изменено успешно!');
                          } else {
                              alert('Ошибка изменения имени пользователя: ' + data.message);
                          }
                      });
                }
            });

            // Настроить уведомления
            document.getElementById('change-notifications').addEventListener('click', function() {
                const notifications = prompt('Введите настройки уведомлений:');
                if (notifications) {
                    // Сохранение настроек уведомлений в базе данных
                    fetch('/change-notifications', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ notifications })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Настройки уведомлений изменены успешно!');
                          } else {
                              alert('Ошибка изменения настроек уведомлений: ' + data.message);
                          }
                      });
                }
            });

            // Изменение и удаление сообщений
            document.getElementById('message-list').addEventListener('click', function(event) {
                if (event.target.classList.contains('edit-message')) {
                    const messageId = event.target.dataset.messageId;
                    const newContent = prompt('Введите новое сообщение:');
                    if (newContent) {
                        // Сохранение изменений в базе данных
                        fetch('/edit-message', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ messageId, newContent })
                        }).then(response => response.json())
                          .then(data => {
                              if (data.success) {
                                  alert('Сообщение изменено успешно!');
                                  // Обновление сообщения на странице
                                  document.querySelector(`[data-message-id="${messageId}"] .message-content`).textContent = newContent;
                              } else {
                                  alert('Ошибка изменения сообщения: ' + data.message);
                              }
                          });
                    }
                } else if (event.target.classList.contains('delete-message')) {
                    const messageId = event.target.dataset.messageId;
                    const deleteForUser = confirm('Удалить сообщение и для другого пользователя?');
                    // Удаление сообщения из базы данных
                    fetch('/delete-message', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ messageId, deleteForUser })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Сообщение удалено успешно!');
                              // Удаление сообщения со страницы
                              document.querySelector(`[data-message-id="${messageId}"]`).remove();
                          } else {
                              alert('Ошибка удаления сообщения: ' + data.message);
                          }
                      });
                }
            });

            // Таймер звонка
            let callTimer;
            function startCallTimer() {
                const startTime = Date.now();
                callTimer = setInterval(() => {
                    const elapsedTime = Date.now() - startTime;
                    const minutes = Math.floor(elapsedTime / 6000);
                    const seconds = Math.floor((elapsedTime % 6000) / 1000);
                    document.querySelector('.timer').textContent = `Звонок длится: ${minutes}:${seconds}`;
                }, 1000);
            }

            function stopCallTimer() {
                clearInterval(callTimer);
                const elapsedTime = document.querySelector('.timer').textContent;
                alert(`Звонок завершен. ${elapsedTime}`);
            }

            // Мелодия звонка
            const ringtone = new Audio('https://example.com/ringtone.mp3');
            document.getElementById('start-voice-call').addEventListener('click', function() {
                ringtone.play();
            });

            // Принять или отклонить звонок
            document.getElementById('accept-call').addEventListener('click', function() {
                ringtone.pause();
                startCallTimer();
            });

            document.getElementById('decline-call').addEventListener('click', function() {
                ringtone.pause();
                stopCallTimer();
            });

            // Открыть панель настроек
            document.getElementById('open-settings').addEventListener('click', function() {
                document.getElementById('settings-panel').style.display = 'block';
            });

            // Сохранить настройки
            document.getElementById('save-settings').addEventListener('click', function() {
                const profileColor = document.getElementById('profile-color').value;
                const siteColor = document.getElementById('site-color').value;

                // Применение настроек
                document.body.style.background = siteColor;
                document.querySelectorAll('.profile').forEach(profile => {
                    profile.style.background = profileColor;
                });

                document.getElementById('settings-panel').style.display = 'none';
            });

            // Показать/скрыть эмодзи-панель
            document.getElementById('emoji-button').addEventListener('click', function() {
                const emojiPicker = document.getElementById('emoji-picker');
                emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
            });

            // Переключение между эмодзи и стикерами
            document.getElementById('emoji-tab').addEventListener('click', function() {
                document.getElementById('emoji-content').style.display = 'flex';
                document.getElementById('sticker-content').style.display = 'none';
                this.classList.add('active');
                document.getElementById('sticker-tab').classList.remove('active');
            });

            document.getElementById('sticker-tab').addEventListener('click', function() {
                document.getElementById('emoji-content').style.display = 'none';
                document.getElementById('sticker-content').style.display = 'flex';
                this.classList.add('active');
                document.getElementById('emoji-tab').classList.remove('active');
            });

            // Добавление эмодзи в сообщение
            document.getElementById('emoji-content').addEventListener('click', function(event) {
                if (event.target.tagName === 'SPAN') {
                    const emoji = event.target.textContent;
                    document.getElementById('message-input').value += emoji;
                }
            });

            // Добавление стикеров в сообщение
            document.getElementById('sticker-content').addEventListener('click', function(event) {
                if (event.target.tagName === 'SPAN') {
                    const sticker = event.target.textContent;
                    document.getElementById('message-input').value += sticker;
                }
            });

            // Добавить права пользователю
            document.getElementById('add-admin-rights').addEventListener('click', function() {
                const serverId = prompt('Введите ID сервера:');
                const userId = prompt('Введите ID пользователя:');
                const rights = prompt('Введите права пользователя (например, модератор, помощник):');
                if (serverId && userId && rights) {
                    // Сохранение прав пользователя в базе данных
                    fetch('/add-admin-rights', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ serverId, userId, rights })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Права пользователя добавлены успешно!');
                          } else {
                              alert('Ошибка добавления прав пользователя: ' + data.message);
                          }
                      });
                }
            });

            // Изменить язык
            document.getElementById('change-language').addEventListener('click', function() {
                const language = prompt('Выберите язык (например, ru, en):');
                if (language) {
                    // Сохранение языка в базе данных
                    fetch('/change-language', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ language })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Язык изменен успешно!');
                              // Обновление языка на странице
                              document.documentElement.lang = language;
                          } else {
                              alert('Ошибка изменения языка: ' + data.message);
                          }
                      });
                }
            });

            // Автоматическое определение языка по IP-адресу
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    const userLanguage = data.languages.split(',')[0];
                    if (confirm(`Установить язык по умолчанию: ${userLanguage}?`)) {
                        document.documentElement.lang = userLanguage;
                    }
                });

            // Показать/скрыть окно загрузки файлов
            document.getElementById('file-button').addEventListener('click', function() {
                const fileUpload = document.getElementById('file-upload');
                fileUpload.style.display = fileUpload.style.display === 'block' ? 'none' : 'block';
            });

            // Предпросмотр файлов
            document.getElementById('file-input').addEventListener('change', function(event) {
                const filePreview = document.getElementById('file-preview');
                filePreview.innerHTML = '';
                const files = event.target.files;
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        filePreview.appendChild(img);
                    } else if (file.type.startsWith('video/')) {
                        const video = document.createElement('video');
                        video.src = URL.createObjectURL(file);
                        video.controls = true;
                        filePreview.appendChild(video);
                    } else {
                        const fileName = document.createElement('div');
                        fileName.textContent = file.name;
                        filePreview.appendChild(fileName);
                    }
                }
            });

            // Отправка файла
            document.getElementById('send-file').addEventListener('click', function() {
                const fileInput = document.getElementById('file-input');
                const files = fileInput.files;
                if (files.length > 0) {
                    const formData = new FormData();
                    for (let i = 0; i < files.length; i++) {
                        formData.append('files', files[i]);
                    }
                    fetch('/send-file', {
                        method: 'POST',
                        body: formData
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Файл отправлен успешно!');
                              document.getElementById('file-upload').style.display = 'none';
                              fileInput.value = '';
                              document.getElementById('file-preview').innerHTML = '';
                          } else {
                              alert('Ошибка отправки файла: ' + data.message);
                          }
                      });
                }
            });

            // Проверка IP-адреса для автоматического входа
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    const userIp = data.ip;
                    const storedIp = localStorage.getItem('userIp');
                    if (storedIp && storedIp === userIp) {
                        const email = localStorage.getItem('userEmail');
                        const password = localStorage.getItem('userPassword');
                        if (email && password) {
                            // Автоматический вход
                            fetch('/login', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ email, password })
                            }).then(response => response.json())
                              .then(data => {
                                  if (data.success) {
                                      alert('Автоматический вход успешен!');
                                      document.getElementById('popup').style.display = 'none';
                                      document.getElementById('login-popup').style.display = 'none';
                                      loadUserData(data.userId);
                                  } else {
                                      alert('Ошибка автоматического входа: ' + data.message);
                                  }
                              });
                        }
                    } else {
                        localStorage.setItem('userIp', userIp);
                    }
                });

            // Загрузка данных пользователя
            function loadUserData(userId) {
                fetch(`/user-data/${userId}`)
                    .then(response => response.json())
                    .then(data => {
                        // Загрузка чатов
                        const messageList = document.getElementById('message-list');
                        messageList.innerHTML = '';
                        data.chats.forEach(chat => {
                            const message = document.createElement('div');
                            message.classList.add('message');
                            message.dataset.messageId = chat.id;
                            message.innerHTML = `
                                <span class="message-content">${chat.content}</span>
                                <div class="message-options">
                                    <button class="edit-message" data-message-id="${chat.id}">Изменить</button>
                                    <button class="delete-message" data-message-id="${chat.id}">Удалить</button>
                                </div>
                            `;
                            messageList.appendChild(message);
                        });

                        // Загрузка серверов
                        const serverList = document.getElementById('server-list');
                        serverList.innerHTML = '';
                        data.servers.forEach(server => {
                            const serverItem = document.createElement('div');
                            serverItem.textContent = server.name;
                            serverList.appendChild(serverItem);
                        });
                    });
            }

            // Добавление пользователей на сервер по ссылке приглашению
            document.getElementById('create-server').addEventListener('click', function() {
                const serverName = prompt('Введите название сервера:');
                if (serverName) {
                    // Сохранение сервера в базе данных
                    fetch('/create-server', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ serverName })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Сервер создан успешно!');
                              // Обновление списка серверов
                              const serverList = document.getElementById('server-list');
                              const newServer = document.createElement('div');
                              newServer.textContent = serverName;
                              serverList.appendChild(newServer);

                              // Создание ссылки приглашения
                              const inviteLink = document.createElement('div');
                              inviteLink.innerHTML = `
                                  <p>Ссылка приглашения: <a href="/join-server/${data.serverId}">/join-server/${data.serverId}</a></p>
                              `;
                              newServer.appendChild(inviteLink);
                          } else {
                              alert('Ошибка создания сервера: ' + data.message);
                          }
                      });
                }
            });

            // Выдача ролей и прав пользователям на сервере
            document.getElementById('add-admin-rights').addEventListener('click', function() {
                const serverId = prompt('Введите ID сервера:');
                const userId = prompt('Введите ID пользователя:');
                const role = prompt('Введите роль пользователя (например, модератор, помощник):');
                const color = prompt('Введите цвет роли (например, #ff0000):');
                if (serverId && userId && role && color) {
                    // Сохранение роли и прав пользователя в базе данных
                    fetch('/add-role', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ serverId, userId, role, color })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Роль пользователя добавлена успешно!');
                          } else {
                              alert('Ошибка добавления роли пользователя: ' + data.message);
                          }
                      });
                }
            });

            // Отправка заявки в друзья
            document.getElementById('send-friend-request').addEventListener('click', function() {
                const username = prompt('Введите username пользователя:');
                if (username) {
                    // Отправка заявки в друзья
                    fetch('/send-friend-request', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Заявка в друзья отправлена успешно!');
                          } else {
                              alert('Ошибка отправки заявки в друзья: ' + data.message);
                          }
                      });
                }
            });

            // Проверка уникальности username при регистрации
            document.getElementById('register').addEventListener('click', function() {
                const username = document.getElementById('username').value;
                if (username) {
                    // Проверка уникальности username
                    fetch('/check-username', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              // Продолжение регистрации
                              const email = document.getElementById('email').value;
                              const password = document.getElementById('password').value;
                              const rememberMe = document.getElementById('remember-me').checked;

                              // Сохранение данных пользователя в базе данных
                              fetch('/register', {
                                  method: 'POST',
                                  headers: {
                                      'Content-Type': 'application/json'
                                  },
                                  body: JSON.stringify({ username, email, password, rememberMe })
                              }).then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        alert('Регистрация успешна!');
                                        document.getElementById('popup').style.display = 'none';
                                        if (rememberMe) {
                                            localStorage.setItem('userEmail', email);
                                            localStorage.setItem('userPassword', password);
                                        }
                                    } else {
                                        alert('Ошибка регистрации: ' + data.message);
                                    }
                                });
                          } else {
                              alert('Username уже занят: ' + data.message);
                          }
                      });
                }
            });

            // Footer
            const footer = document.createElement('footer');
            footer.innerHTML = '<p>Все права защищены Artsoft Team & Fox.inc</p>';
            document.body.appendChild(footer);
        });

        // Защита от атак и нагрузок
        async function secureSite() {
            // Включение HTTPS
            if (location.protocol !== 'https:') {
                location.replace(`https:${location.href.substring(location.protocol.length)}`);
            }

            // Защита от XSS атак
            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', () => {
                    input.value = input.value.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                });
            });

            // Защита от CSRF атак
            const csrfToken = await fetch('/csrf-token').then(response => response.text());
            document.querySelectorAll('form').forEach(form => {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrf-token';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
            });

            // Защита от DDoS атак
            const rateLimit = {};
            document.addEventListener('click', () => {
                const now = Date.now();
                if (!rateLimit[now]) {
                    rateLimit[now] = 0;
                }
                rateLimit[now]++;
                if (rateLimit[now] > 100) {
                    alert('Слишком много запросов. Пожалуйста, подождите.');
                    return false;
                }
            });

            // Защита от SQL инъекций
            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', () => {
                    input.value = input.value.replace(/'/g, "''");
                });
            });

            // Шифрование данных
            const encrypt = (data) => {
                const key = CryptoJS.enc.Utf8.parse('1234567890123456');
                const iv = CryptoJS.enc.Utf8.parse('1234567890123456');
                return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(data), key, {
                    keySize: 128 / 8,
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                }).toString();
            };

            const decrypt = (data) => {
                const key = CryptoJS.enc.Utf8.parse('1234567890123456');
                const iv = CryptoJS.enc.Utf8.parse('1234567890123456');
                return CryptoJS.AES.decrypt(data, key, {
                    keySize: 128 / 8,
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                }).toString(CryptoJS.enc.Utf8);
            };

            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', () => {
                    input.value = encrypt(input.value);
                });
            });

            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const formData = new FormData(form);
                    formData.forEach((value, key) => {
                        formData.set(key, encrypt(value));
                    });
                    fetch(form.action, {
                        method: form.method,
                        body: formData
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              alert('Данные успешно отправлены!');
                          } else {
                              alert('Ошибка отправки данных: ' + data.message);
                          }
                      });
                });
            });
        }

        secureSite();
    </script>
</body>
</html>
